
Cuando un mensaje viaja por **múltiples redes (subredes)** y atraviesa **routers**, las **MAC addresses cambian en cada salto**, pero las **direcciones IP origen y destino se mantienen** (capa 3 no cambia).

---

## 🔎 Escenario de ejemplo

- **PC A** → Red 192.168.1.0/24
    - IP: 192.168.1.10
    - MAC: `AA-AA-AA-AA-AA-AA`
- **Router 1**
    - Fa0/0: 192.168.1.1 — MAC `11-11-11-11-11-11`
    - Fa0/1: 10.0.0.1 — MAC `22-22-22-22-22-22`
- **Router 2**
    - Fa0/0: 10.0.0.2 — MAC `33-33-33-33-33-33`
    - Fa0/1: 192.168.2.1 — MAC `44-44-44-44-44-44`
- **PC B (servidor)** → Red 192.168.2.0/24
    - IP: 192.168.2.20
    - MAC: `BB-BB-BB-BB-BB-BB`

---

## 📡 Paso a paso: ¿qué pasa con las MAC?

### 1️⃣ PC A → Router 1

- **IP Origen**: 192.168.1.10
- **IP Destino**: 192.168.2.20
- **MAC Origen**: `AA-AA-AA-AA-AA-AA` (NIC de PC A)
- **MAC Destino**: `11-11-11-11-11-11` (interfaz del router 1 en esa red)

_(PC A usa ARP para averiguar la MAC de su **gateway**)_

---

### 2️⃣ Router 1 → Router 2 (red 10.0.0.0/30)

El router 1 **reencapsula la trama** con nuevas MAC:

- **IP Origen**: 192.168.1.10 (NO cambia)
- **IP Destino**: 192.168.2.20 (NO cambia)
- **MAC Origen**: `22-22-22-22-22-22` (salida Fa0/1 de R1)
- **MAC Destino**: `33-33-33-33-33-33` (entrada Fa0/0 de R2)

---

### 3️⃣ Router 2 → PC B

Router 2 ve que el destino final está en su red local (192.168.2.0/24).

- **IP Origen**: 192.168.1.10
- **IP Destino**: 192.168.2.20
- **MAC Origen**: `44-44-44-44-44-44` (Fa0/1 de R2)
- **MAC Destino**: `BB-BB-BB-BB-BB-BB` (PC B)

---

## ✅ Resumen

- **Las IPs origen y destino nunca cambian** a lo largo del camino.
- **Las MACs sí cambian en cada salto**, porque cada enlace físico es diferente:
    - PC A → R1
    - R1 → R2
    - R2 → PC B

---

📌 Esto es lo que en Cisco llamamos:

- **Direcciones IP = lógicas, de capa 3, extremo a extremo.**
- **Direcciones MAC = físicas, de capa 2, cambian salto a salto.**

---

Muy buena pregunta 👌

Cuando un router recibe un paquete, **no decide según la MAC**, sino mirando la **IP destino** en la **capa 3**. La decisión de cuál ruta usar se basa en su **tabla de enrutamiento**.

---

## 🔎 Factores que determinan qué ruta elige un router:

1. **Dirección IP destino**
    - El router compara la IP destino del paquete con las redes que conoce en su **tabla de enrutamiento**.
    - Busca la coincidencia más específica (la máscara más larga, _longest prefix match_).
2. **Métrica / costo de la ruta**  
    Si hay varias rutas hacia el mismo destino, el router escoge la que tenga:
    - **Menor métrica** (depende del protocolo de enrutamiento).
        - RIP → número de saltos.
        - OSPF → costo basado en ancho de banda.
        - EIGRP → métrica compuesta (ancho de banda, retraso, etc.).
    - **Distancia administrativa (AD)** más baja → determina la “confianza” de la fuente de la ruta.
        - Directa = 0
        - Estática = 1
        - EIGRP = 90
        - OSPF = 110
        - RIP = 120
3. **Balanceo de carga (ECMP)**  
    Si hay varias rutas con la misma métrica y misma AD, algunos protocolos permiten repartir el tráfico entre ellas (equal-cost multipath).

---

## ✅ Ejemplo

Un router recibe un paquete para **192.168.2.10**.  
En su tabla tiene:

- `192.168.2.0/24 via 10.0.0.2` → métrica 10
- `192.168.2.0/24 via 10.0.1.2` → métrica 20

👉 Elegirá la primera ruta (menor costo).

---

📌 Resumen sencillo:

- **La IP destino** determina la red de salida.
- **La tabla de enrutamiento** decide qué interfaz usar.
- **La métrica y distancia administrativa** resuelven conflictos si hay más de una ruta.

---
---

## 📜 Ejemplo de `show ip route`

```
R1# show ip routeCodes: C - connected, S - static, R - RIP, O - OSPF, D - EIGRPGateway of last resort is not set     192.168.1.0/24 is variably subnetted, 2 subnets, 2 masksC       192.168.1.0/24 is directly connected, FastEthernet0/0L       192.168.1.1/32 is directly connected, FastEthernet0/0S    192.168.2.0/24 [1/0] via 10.0.0.2O    192.168.3.0/24 [110/20] via 10.0.0.2, 00:00:22, FastEthernet0/1D    192.168.4.0/24 [90/2172416] via 10.0.1.2, 00:00:15, FastEthernet0/2
```

---

## 🔎 Explicación de las rutas

1. **C** → _Connected_
    - `192.168.1.0/24` está directamente conectado en la interfaz **Fa0/0**.
    - `192.168.1.1/32` es la dirección IP del propio router en esa interfaz.
2. **S** → _Static_
    - `192.168.2.0/24` se alcanza mediante la dirección **10.0.0.2**.
    - `[1/0]` = distancia administrativa **1** (estática) y métrica **0**.
3. **O** → _OSPF_
    - `192.168.3.0/24` llega por OSPF a través de **10.0.0.2**.
    - `[110/20]` = AD **110**, costo OSPF **20**.
4. **D** → _EIGRP_
    - `192.168.4.0/24` llega por EIGRP vía **10.0.1.2**.
    - `[90/2172416]` = AD **90**, métrica compuesta **2172416**.

---

## ✅ ¿Cómo elige el router la ruta?

- Primero mira la **red de destino** (ej. 192.168.4.10 → coincide con 192.168.4.0/24).
- Luego, si hay varias rutas para la misma red:
    - Escoge la de **menor AD (más confiable)**.
    - Si la AD es igual, compara la **métrica**.
    - Si ambas son iguales → puede hacer **balanceo de carga**.

---
![[Pasted image 20250829124809.png]]


14.2.5 La puerta de enlace predeterminada

![[Pasted image 20250829125041.png]]

