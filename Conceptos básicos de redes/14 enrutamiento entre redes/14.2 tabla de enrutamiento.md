
Cuando un mensaje viaja por **mÃºltiples redes (subredes)** y atraviesa **routers**, las **MAC addresses cambian en cada salto**, pero las **direcciones IP origen y destino se mantienen** (capa 3 no cambia).

---

## ğŸ” Escenario de ejemplo

- **PC A** â†’ Red 192.168.1.0/24
    - IP: 192.168.1.10
    - MAC: `AA-AA-AA-AA-AA-AA`
- **Router 1**
    - Fa0/0: 192.168.1.1 â€” MAC `11-11-11-11-11-11`
    - Fa0/1: 10.0.0.1 â€” MAC `22-22-22-22-22-22`
- **Router 2**
    - Fa0/0: 10.0.0.2 â€” MAC `33-33-33-33-33-33`
    - Fa0/1: 192.168.2.1 â€” MAC `44-44-44-44-44-44`
- **PC B (servidor)** â†’ Red 192.168.2.0/24
    - IP: 192.168.2.20
    - MAC: `BB-BB-BB-BB-BB-BB`

---

## ğŸ“¡ Paso a paso: Â¿quÃ© pasa con las MAC?

### 1ï¸âƒ£ PC A â†’ Router 1

- **IP Origen**: 192.168.1.10
- **IP Destino**: 192.168.2.20
- **MAC Origen**: `AA-AA-AA-AA-AA-AA` (NIC de PC A)
- **MAC Destino**: `11-11-11-11-11-11` (interfaz del router 1 en esa red)

_(PC A usa ARP para averiguar la MAC de su **gateway**)_

---

### 2ï¸âƒ£ Router 1 â†’ Router 2 (red 10.0.0.0/30)

El router 1 **reencapsula la trama** con nuevas MAC:

- **IP Origen**: 192.168.1.10 (NO cambia)
- **IP Destino**: 192.168.2.20 (NO cambia)
- **MAC Origen**: `22-22-22-22-22-22` (salida Fa0/1 de R1)
- **MAC Destino**: `33-33-33-33-33-33` (entrada Fa0/0 de R2)

---

### 3ï¸âƒ£ Router 2 â†’ PC B

Router 2 ve que el destino final estÃ¡ en su red local (192.168.2.0/24).

- **IP Origen**: 192.168.1.10
- **IP Destino**: 192.168.2.20
- **MAC Origen**: `44-44-44-44-44-44` (Fa0/1 de R2)
- **MAC Destino**: `BB-BB-BB-BB-BB-BB` (PC B)

---

## âœ… Resumen

- **Las IPs origen y destino nunca cambian** a lo largo del camino.
- **Las MACs sÃ­ cambian en cada salto**, porque cada enlace fÃ­sico es diferente:
    - PC A â†’ R1
    - R1 â†’ R2
    - R2 â†’ PC B

---

ğŸ“Œ Esto es lo que en Cisco llamamos:

- **Direcciones IP = lÃ³gicas, de capa 3, extremo a extremo.**
- **Direcciones MAC = fÃ­sicas, de capa 2, cambian salto a salto.**

---

Muy buena pregunta ğŸ‘Œ

Cuando un router recibe un paquete, **no decide segÃºn la MAC**, sino mirando la **IP destino** en la **capa 3**. La decisiÃ³n de cuÃ¡l ruta usar se basa en su **tabla de enrutamiento**.

---

## ğŸ” Factores que determinan quÃ© ruta elige un router:

1. **DirecciÃ³n IP destino**
    - El router compara la IP destino del paquete con las redes que conoce en su **tabla de enrutamiento**.
    - Busca la coincidencia mÃ¡s especÃ­fica (la mÃ¡scara mÃ¡s larga, _longest prefix match_).
2. **MÃ©trica / costo de la ruta**  
    Si hay varias rutas hacia el mismo destino, el router escoge la que tenga:
    - **Menor mÃ©trica** (depende del protocolo de enrutamiento).
        - RIP â†’ nÃºmero de saltos.
        - OSPF â†’ costo basado en ancho de banda.
        - EIGRP â†’ mÃ©trica compuesta (ancho de banda, retraso, etc.).
    - **Distancia administrativa (AD)** mÃ¡s baja â†’ determina la â€œconfianzaâ€ de la fuente de la ruta.
        - Directa = 0
        - EstÃ¡tica = 1
        - EIGRP = 90
        - OSPF = 110
        - RIP = 120
3. **Balanceo de carga (ECMP)**  
    Si hay varias rutas con la misma mÃ©trica y misma AD, algunos protocolos permiten repartir el trÃ¡fico entre ellas (equal-cost multipath).

---

## âœ… Ejemplo

Un router recibe un paquete para **192.168.2.10**.  
En su tabla tiene:

- `192.168.2.0/24 via 10.0.0.2` â†’ mÃ©trica 10
- `192.168.2.0/24 via 10.0.1.2` â†’ mÃ©trica 20

ğŸ‘‰ ElegirÃ¡ la primera ruta (menor costo).

---

ğŸ“Œ Resumen sencillo:

- **La IP destino** determina la red de salida.
- **La tabla de enrutamiento** decide quÃ© interfaz usar.
- **La mÃ©trica y distancia administrativa** resuelven conflictos si hay mÃ¡s de una ruta.

---
---

## ğŸ“œ Ejemplo de `show ip route`

```
R1# show ip routeCodes: C - connected, S - static, R - RIP, O - OSPF, D - EIGRPGateway of last resort is not setÂ Â Â Â Â 192.168.1.0/24 is variably subnetted, 2 subnets, 2 masksCÂ Â Â Â Â Â Â 192.168.1.0/24 is directly connected, FastEthernet0/0LÂ Â Â Â Â Â Â 192.168.1.1/32 is directly connected, FastEthernet0/0SÂ Â Â Â 192.168.2.0/24 [1/0] via 10.0.0.2OÂ Â Â Â 192.168.3.0/24 [110/20] via 10.0.0.2, 00:00:22, FastEthernet0/1DÂ Â Â Â 192.168.4.0/24 [90/2172416] via 10.0.1.2, 00:00:15, FastEthernet0/2
```

---

## ğŸ” ExplicaciÃ³n de las rutas

1. **C** â†’ _Connected_
    - `192.168.1.0/24` estÃ¡ directamente conectado en la interfaz **Fa0/0**.
    - `192.168.1.1/32` es la direcciÃ³n IP del propio router en esa interfaz.
2. **S** â†’ _Static_
    - `192.168.2.0/24` se alcanza mediante la direcciÃ³n **10.0.0.2**.
    - `[1/0]` = distancia administrativa **1** (estÃ¡tica) y mÃ©trica **0**.
3. **O** â†’ _OSPF_
    - `192.168.3.0/24` llega por OSPF a travÃ©s de **10.0.0.2**.
    - `[110/20]` = AD **110**, costo OSPF **20**.
4. **D** â†’ _EIGRP_
    - `192.168.4.0/24` llega por EIGRP vÃ­a **10.0.1.2**.
    - `[90/2172416]` = AD **90**, mÃ©trica compuesta **2172416**.

---

## âœ… Â¿CÃ³mo elige el router la ruta?

- Primero mira la **red de destino** (ej. 192.168.4.10 â†’ coincide con 192.168.4.0/24).
- Luego, si hay varias rutas para la misma red:
    - Escoge la de **menor AD (mÃ¡s confiable)**.
    - Si la AD es igual, compara la **mÃ©trica**.
    - Si ambas son iguales â†’ puede hacer **balanceo de carga**.

---
![[Pasted image 20250829124809.png]]


14.2.5 La puerta de enlace predeterminada

![[Pasted image 20250829125041.png]]

